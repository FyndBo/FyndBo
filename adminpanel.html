<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FyndBo Adminpanel</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --blue: #1e5fa5;           /* Ljusare blå nyans */
  --lightblue: #e8f2fb;
  --bg: #f7f9fc;
  --white: #ffffff;
  --shadow: 0 4px 12px rgba(0,0,0,0.08);
}
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: var(--bg);
  color: #1f2937;
  min-height: 100vh;
}

/* LOGIN */
#loginOverlay {
  position: fixed; inset: 0;
  background: linear-gradient(135deg, #e3f2fd, #bbdefb);
  display: flex; align-items: center; justify-content: center;
  z-index: 1000;
}
.login-box {
  background: #fff; padding: 40px 50px; border-radius: 16px;
  box-shadow: var(--shadow); text-align: center;
  max-width: 360px; width: 100%;
}
.login-box img { width: 100px; margin-bottom: 10px; }
.login-box h2 { color: var(--blue); margin-bottom: 20px; }
.login-box input {
  width: 100%; padding: 12px; margin-bottom: 15px;
  border: 1px solid #ccc; border-radius: 8px;
}
.login-box button {
  background: var(--blue); color: #fff; border: none; padding: 12px 30px;
  border-radius: 8px; cursor: pointer; width: 100%; transition: 0.3s;
}
.login-box button:hover { background: #114b88; }
.error { color: red; margin-top: 10px; display: none; }

/* PANEL */
#adminPanel { display: none; height: 100vh; display: flex; flex-direction: column; }
header {
  background: var(--blue); color: #fff; display: flex; align-items: center;
  justify-content: space-between; padding: 10px 30px; box-shadow: var(--shadow);
}
header img { height: 120px; cursor: pointer; transition: 0.3s; }
header img:hover { transform: scale(1.03); }
.logout-btn {
  background: #fff; color: var(--blue); padding: 8px 18px; border-radius: 20px;
  text-decoration: none; font-weight: 600; transition: 0.3s;
}
.logout-btn:hover { background: var(--blue); color: #fff; border: 1px solid #fff; }

.wrapper { display: flex; flex: 1; }
aside {
  width: 270px; background: #ffffff; box-shadow: 2px 0 8px rgba(0,0,0,0.05);
  padding: 25px 0; display: flex; flex-direction: column;
}
aside h3 { margin: 0 0 15px 25px; color: var(--blue); font-size: 1.2em; }
aside section { margin-bottom: 25px; }
aside .section-title {
  font-weight: 600;
  padding: 8px 25px;
  color: var(--blue);
  text-transform: uppercase;
  font-size: 0.9em;
  letter-spacing: 0.5px;
}
aside a {
  display: block; padding: 8px 40px; color: #333; text-decoration: none;
  font-size: 0.95em; transition: 0.2s;
}
aside a:hover { background: var(--lightblue); color: var(--blue); border-radius: 8px; }

main { flex: 1; padding: 40px; overflow-y: auto; }
main h1 { color: var(--blue); margin-bottom: 25px; font-size: 1.9em; }

/* Cards */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
}
.card {
  background: #fff; border-radius: 12px; padding: 20px;
  box-shadow: var(--shadow); transition: transform .2s, box-shadow .2s;
}
.card:hover { transform: translateY(-5px); box-shadow: 0 8px 18px rgba(0,0,0,0.1); }
.card i { font-size: 1.8em; color: var(--blue); margin-bottom: 8px; }
.card h3 { color: var(--blue); margin: 8px 0; }

footer {
  text-align: center; padding: 15px; background: var(--lightblue); color: var(--blue);
}

/* Form */
#addPageForm {
  background: #fff; padding: 25px; border-radius: 12px;
  box-shadow: var(--shadow); margin-top: 40px; max-width: 480px;
}
#addPageForm input, #addPageForm select {
  width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px;
  border: 1px solid #ccc;
}
#addPageForm button {
  background: var(--blue); color: #fff; border: none; padding: 12px 30px;
  border-radius: 8px; cursor: pointer; transition: 0.3s;
}
#addPageForm button:hover { background: #114b88; }

.status-msg {
  margin-top: 8px;
  font-weight: 500;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginOverlay">
  <div class="login-box">
    <img src="images/FyndBo-blue-removebg-preview.png" alt="FyndBo Logo">
    <h2>Admininloggning</h2>
    <input type="text" id="username" placeholder="Användarnamn">
    <input type="password" id="password" placeholder="Lösenord">
    <button onclick="checkLogin()">Logga in</button>
    <p class="error" id="errorMsg">Fel användarnamn eller lösenord</p>
  </div>
</div>

<!-- ADMINPANEL -->
<div id="adminPanel">
  <header>
    <img src="images/FyndBo-blue-removebg-preview.png" alt="FyndBo Logo" id="logoLink">
    <a href="#" class="logout-btn" onclick="logout()">Logga ut</a>
  </header>

  <div class="wrapper">
    <aside>
      <h3>Navigation</h3>

      <section>
        <div class="section-title"><i class="fa-solid fa-folder-open"></i> Sidor</div>
        <div id="pageLinks"><p style="padding-left:40px;">Laddar sidor...</p></div>
      </section>

      <section>
        <div class="section-title"><i class="fa-solid fa-gear"></i> Hantering</div>
        <a href="bostader.html">Bostäder</a>
        <a href="anvandare.html">Användare</a>
        <a href="statistik.html">Statistik</a>
      </section>

      <section>
        <div class="section-title"><i class="fa-solid fa-envelope"></i> Meddelanden</div>
        <a href="inkorg.html">Inkorg</a>
        <a href="nyttobjekt.html">Lägg till objekt</a>
      </section>
    </aside>

    <main>
      <h1>Välkommen till FyndBos Adminpanel</h1>
      <p id="statusMsg" style="color:gray;"></p>

      <div class="grid">
        <div class="card">
          <i class="fa-solid fa-house"></i>
          <h3>Hantera bostäder</h3>
          <p>Lägg till, redigera eller ta bort bostadsannonser.</p>
        </div>
        <div class="card">
          <i class="fa-solid fa-users"></i>
          <h3>Användare</h3>
          <p>Se registrerade användare och administratörer.</p>
        </div>
        <div class="card">
          <i class="fa-solid fa-chart-line"></i>
          <h3>Statistik</h3>
          <p>Visa webbplatsdata, sidvisningar och popularitet.</p>
        </div>
        <div class="card">
          <i class="fa-solid fa-plus"></i>
          <h3>Lägg till nytt objekt</h3>
          <p>Publicera en ny annons direkt till bostadsflödet.</p>
        </div>
      </div>

      <h2 style="color:var(--blue);margin-top:50px;">Lägg till ny sida</h2>
      <form id="addPageForm">
        <input type="text" id="newPageName" placeholder="Sidnamn (t.ex. Kontakt)" required>
        <input type="text" id="newPageUrl" placeholder="URL (t.ex. kontakt.html)" required>
        <select id="newPageCategory" required>
          <option value="">Välj kategori...</option>
          <option value="publik">Publik</option>
          <option value="admin">Admin</option>
        </select>
        <button type="submit">Lägg till sida</button>
        <p id="addPageMsg" class="status-msg"></p>
      </form>
    </main>
  </div>

  <footer>&copy; 2025 FyndBo – Adminpanel</footer>
</div>

<!-- SUPABASE SCRIPT -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://ymqwoiuhummwrtzfhbgm.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltcXdvaXVodW1td3J0emZoYmdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMDYzOTAsImV4cCI6MjA3Njg4MjM5MH0.9s0iaJm_RGJxZFyPZqQyZvPCeCz60Q6P8EsPxfSO2AI"
);

const container = document.getElementById("pageLinks");
const statusMsg = document.getElementById("statusMsg");

async function loadPages() {
  const { data, error } = await supabase.from("pages").select("*").order("category", { ascending: true });
  if (error) {
    console.error(error);
    container.innerHTML = "<p style='padding-left:40px;'>Kunde inte hämta sidor.</p>";
    statusMsg.textContent = "❌ Fel vid anslutning till databasen.";
    return;
  }

  if (!data || data.length === 0) {
    container.innerHTML = "<p style='padding-left:40px;'>Inga sidor hittades.</p>";
    return;
  }

  const publik = data.filter(p => p.category === "publik");
  const admin = data.filter(p => p.category === "admin");

  container.innerHTML = `
    ${admin.length ? `<strong style="color:#b91c1c;padding-left:25px;">Admin Sidor</strong>${admin.map(p => `<a href="${p.url}" target="_blank">${p.name}</a>`).join('')}` : ""}
    ${publik.length ? `<strong style="color:#0f4c81;padding-left:25px;display:block;margin-top:10px;">Publika Sidor</strong>${publik.map(p => `<a href="${p.url}" target="_blank">${p.name}</a>`).join('')}` : ""}
  `;
  statusMsg.textContent = "✅ Sidor hämtade från databasen!";
}

document.addEventListener("DOMContentLoaded", loadPages);

const form = document.getElementById("addPageForm");
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = document.getElementById("newPageName").value.trim();
  const url = document.getElementById("newPageUrl").value.trim();
  const category = document.getElementById("newPageCategory").value.trim();
  const msg = document.getElementById("addPageMsg");

  if (!name || !url || !category) {
    msg.textContent = "⚠️ Fyll i alla fält.";
    msg.style.color = "red";
    return;
  }

  const { error } = await supabase.from("pages").insert([{ name, url, category }]);
  if (error) {
    console.error(error);
    msg.textContent = "❌ Kunde inte lägga till sidan.";
    msg.style.color = "red";
  } else {
    msg.textContent = "✅ Sidan lades till!";
    msg.style.color = "green";
    form.reset();
    loadPages();
  }
});
</script>

<!-- LOGIN SCRIPT -->
<script>
const _u = atob("RnluZGJvLUFkbWlu");
const _p = atob("RnluZEJvLTE=");

function checkLogin() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  const e = document.getElementById("errorMsg");
  if (u === _u && p === _p) {
    document.getElementById("loginOverlay").style.display = "none";
    document.getElementById("adminPanel").style.display = "flex";
    localStorage.setItem("loggedIn", "true");
  } else {
    e.style.display = "block";
  }
}

if (localStorage.getItem("loggedIn") === "true") {
  document.getElementById("loginOverlay").style.display = "none";
  document.getElementById("adminPanel").style.display = "flex";
}

function logout() {
  localStorage.removeItem("loggedIn");
  document.getElementById("adminPanel").style.display = "none";
  document.getElementById("loginOverlay").style.display = "flex";
}

document.getElementById("logoLink").addEventListener("click", () => {
  window.location.href = "index.html";
});
</script>

</body>
</html>
